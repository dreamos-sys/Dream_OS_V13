<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Dream OS v13.4 - Symmetric Soul</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; overscroll-behavior: none; }
        .arabic { font-family: 'Amiri', serif; }
        .glass-dark { background: rgba(15, 23, 42, 0.85); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.05); }
        
        /* Pulse Animation for Spiritual Aura */
        @keyframes spiritual-glow { 0%, 100% { box-shadow: 0 0 20px rgba(251, 191, 36, 0.1); } 50% { box-shadow: 0 0 40px rgba(251, 191, 36, 0.3); } }
        .spiritual-pillar { animation: spiritual-glow 4s infinite; border-top: 3px solid #fbbf24; }
        
        .fade-in { transition: opacity 0.8s ease-in-out; }
    </style>
</head>
<body class="bg-[#0b1120] min-h-screen text-slate-100 p-4">
    <div id="app" class="max-w-md mx-auto flex flex-col min-h-screen">
        
        <header class="glass-dark spiritual-pillar rounded-[2.5rem] p-8 mb-6 text-center shadow-2xl">
            <p class="text-3xl arabic text-yellow-500 mb-2">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ€Ù°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</p>
            <p class="text-xs arabic text-yellow-600/70 leading-relaxed">Ø§ÙÙ„Ù„Ù‡Ù… ØµÙÙ„Ù‘Ù Ø¹ÙÙ„ÙÙ‰ Ø³ÙÙŠÙ‘ÙØ¯ÙÙ†ÙØ§ Ù…ÙØ­ÙÙ…Ù‘ÙØ¯Ù ÙˆÙØ¹ÙÙ„ÙÙ‰ Ø¢Ù„Ù Ø³ÙÙŠÙ‘ÙØ¯ÙÙ†ÙØ§ Ù…ÙØ­ÙÙ…Ù‘ÙØ¯Ù</p>
            <div class="mt-4 flex justify-center gap-4 opacity-30">
                <span class="text-[8px] font-black tracking-[0.4em]">DREAM OS v13.4</span>
            </div>
        </header>

        <div id="slideshow-area" class="hidden">
            <div class="glass-dark rounded-[2.5rem] p-8 mb-8 shadow-2xl border-b-4 border-yellow-500/20 relative overflow-hidden">
                <div id="slide-content" class="fade-in min-h-[100px] flex flex-col justify-center">
                    <h2 class="text-3xl arabic text-white mb-2">Ø£ÙÙ‡Ù’Ù„Ù‹Ø§ ÙˆÙØ³ÙÙ‡Ù’Ù„Ù‹Ø§</h2>
                    <p class="text-[11px] font-bold text-yellow-500/80 tracking-widest uppercase">Command Center SIF Al-Fikri</p>
                </div>
                
                <div class="mt-6 flex items-center justify-between opacity-50">
                    <div class="flex items-center gap-2">
                        <div class="h-2 w-2 rounded-full bg-green-500 animate-pulse"></div>
                        <span class="text-[9px] font-black tracking-widest" id="panel-tag">ISO 27001 ACTIVE</span>
                    </div>
                    <span class="text-[9px] font-bold" id="slide-num">01 / 07</span>
                </div>
            </div>
        </div>

        <main id="main-content" class="flex-grow"></main>

        <footer class="py-6 text-center">
            <p class="text-[9px] opacity-20 font-black tracking-[0.6em] uppercase italic">Dream Team â€” Out of The Box Inside</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module">
        const SUPABASE_URL = 'https://rqpodzjexghrvcpyacyo.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_U9MbSdPJOMSmaw3BsHJcVQ_PDiOy-UM';
        window.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        let curSlide = 0;

        // --- AUTOMATED CONTENT ENGINE --- [cite: 2026-01-11, 2026-01-18]
        async function getContent() {
            const { count: b } = await window.supabase.from('bookings').select('*', { count: 'exact', head: true }).eq('status', 'pending');
            const { count: k } = await window.supabase.from('k3_reports').select('*', { count: 'exact', head: true }).eq('status', 'pending');
            const isJumat = new Date().getDay() === 5;

            return [
                { title: "Ø£ÙÙ‡Ù’Ù„Ù‹Ø§ ÙˆÙØ³ÙÙ‡Ù’Ù„Ù‹Ø§", sub: "Command Center SIF Al-Fikri", tag: "ISO 27001 ACTIVE", isArabic: true },
                { title: "ğŸ“… BOOKING STATUS", sub: `Ada ${b || 0} Antrean Menunggu Persetujuan Bapak Hanung`, tag: "APPROVAL SYSTEM" },
                { title: "âš ï¸ LAPORAN K3", sub: `Terdeteksi ${k || 0} Kendala Teknis Di Area Kerja`, tag: "MAINTENANCE MODE" },
                { title: "ğŸ›¡ï¸ SAFE CORE 5KM", sub: "Proteksi Lokasi Depok & Redmi Note 9 Pro Aktif", tag: "SECURITY LOCKED" },
                { title: isJumat ? "ğŸ•Œ JUMAT BERKAH" : "ğŸš€ DREAM TEAM", sub: isJumat ? "Waktunya Memperbanyak Shalawat & Sedekah" : "Out of The Box Inside Sejak Awal", tag: "SPIRITUAL MODE" },
                { title: "ğŸŒ¤ï¸ AREA MONITORING", sub: "Cuaca & Kondisi Sekitar Terpantau Stabil", tag: "STABLE SYSTEM" },
                { title: "ğŸ“¢ DATA INTEGRITY", sub: "Sistem Backup & Restore ISO 27001 Berjalan", tag: "ENCRYPTED DATA" }
            ];
        }

        async function startSmartLoop() {
            const display = document.getElementById('slide-content');
            const tag = document.getElementById('panel-tag');
            const num = document.getElementById('slide-num');
            const slides = await getContent();

            setInterval(() => {
                display.style.opacity = '0';
                setTimeout(() => {
                    const s = slides[curSlide];
                    display.innerHTML = `
                        <h2 class="${s.isArabic ? 'text-3xl arabic' : 'text-xl font-black text-yellow-500'} mb-2 uppercase">${s.title}</h2>
                        <p class="text-[11px] opacity-70 font-semibold leading-relaxed">${s.sub}</p>
                    `;
                    tag.textContent = s.tag;
                    num.textContent = `0${curSlide + 1} / 07`;
                    display.style.opacity = '1';
                    curSlide = (curSlide + 1) % slides.length;
                }, 600);
            }, 7000); // 7 Detik Roleplay [cite: 2026-01-11]
        }

        // --- CORE ROUTER ---
        async function router() {
            const content = document.getElementById('main-content');
            const slider = document.getElementById('slideshow-area');
            const allowed = sessionStorage.getItem('allowed_modules');

            if (!allowed) {
                slider.style.display = 'none';
                renderLogin();
                return;
            }

            slider.style.display = 'block';
            if(!window.loopActive) { startSmartLoop(); window.loopActive = true; }

            const hash = (window.location.hash || '#home').slice(1);
            try {
                const res = await fetch(`./modules/${hash}/index.html`);
                content.innerHTML = await res.text();
                
                const old = document.getElementById('mod-script');
                if (old) old.remove();
                const script = document.createElement('script');
                script.id = 'mod-script';
                script.type = 'module';
                script.src = `./modules/${hash}/${hash}.js?v=${Date.now()}`;
                document.body.appendChild(script);
            } catch { window.location.hash = '#home'; }
        }

        function renderLogin() {
            document.getElementById('main-content').innerHTML = `
                <div class="glass-dark p-10 rounded-[2.5rem] mt-4 text-center spiritual-pillar">
                    <input type="password" id="mk" placeholder="MASTER KEY" class="w-full p-5 rounded-2xl bg-[#0b1120] border-none text-center font-black mb-6 ring-1 ring-white/10 focus:ring-yellow-500 text-white tracking-widest">
                    <button id="btnLogin" class="w-full bg-yellow-500 p-5 rounded-2xl font-black text-[#0b1120] hover:bg-yellow-400 transition-all active:scale-95 shadow-2xl uppercase tracking-[0.2em]">Enter System</button>
                </div>
            `;
            document.getElementById('btnLogin').onclick = async () => {
                const { data } = await window.supabase.from('access_codes').select('*').eq('code', document.getElementById('mk').value).maybeSingle();
                if (data) {
                    sessionStorage.setItem('allowed_modules', JSON.stringify(data.allowed_modules));
                    window.location.hash = '#home';
                    router();
                }
            };
        }

        window.addEventListener('hashchange', router);
        window.addEventListener('load', router);
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Dream OS v13.4 - Twin Pillars</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; overscroll-behavior: none; background: #0b1120; color: white; }
        .arabic { font-family: 'Amiri', serif; }
        .glass-card { 
            background: rgba(15, 23, 42, 0.8); 
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 2.5rem;
            padding: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        .pillar-gold { border-top: 3px solid #fbbf24; }
        .slide-fade { transition: all 0.6s ease-in-out; }
        @keyframes glow { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .glow-text { animation: glow 3s infinite; }
    </style>
</head>
<body class="p-4">
    <div id="app" class="max-w-md mx-auto flex flex-col min-h-screen">
        
        <div class="glass-card pillar-gold mb-6 text-center">
            <p class="text-3xl arabic text-yellow-500 glow-text">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ€Ù°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</p>
            <p class="text-[11px] arabic text-yellow-600/70 mt-2 leading-relaxed">
                Ø§ÙÙ„Ù„Ù‡Ù… ØµÙÙ„Ù‘Ù Ø¹ÙÙ„ÙÙ‰ Ø³ÙÙŠÙ‘ÙØ¯ÙÙ†ÙØ§ Ù…ÙØ­ÙÙ…Ù‘ÙØ¯Ù ÙˆÙØ¹ÙÙ„ÙÙ‰ Ø¢Ù„Ù Ø³ÙÙŠÙ‘ÙØ¯ÙÙ†ÙØ§ Ù…ÙØ­ÙÙ…Ù‘ÙØ¯Ù
            </p>
            <p class="text-[8px] tracking-[0.4em] opacity-20 font-black mt-4 uppercase">Dream OS v13.4 Master</p>
        </div>

        <div id="logged-in-area" class="hidden">
            <div class="glass-card mb-8 relative overflow-hidden border-b-4 border-yellow-500/10">
                <div id="smart-content" class="slide-fade min-h-[110px] flex flex-col justify-center">
                    <h2 class="text-3xl arabic text-white mb-1">Ø£ÙÙ‡Ù’Ù„Ù‹Ø§ ÙˆÙØ³ÙÙ‡Ù’Ù„Ù‹Ø§</h2>
                    <p class="text-xs font-bold text-yellow-500/80 tracking-widest uppercase">Command Center SIF Al-Fikri</p>
                </div>
                
                <div class="mt-6 pt-4 border-t border-white/5 flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        <span class="h-2 w-2 rounded-full bg-green-500 shadow-[0_0_10px_#22c55e]"></span>
                        <span class="text-[9px] font-black tracking-[0.2em] text-green-400" id="status-tag">ISO 27001 ACTIVE</span>
                    </div>
                    <span class="text-[9px] font-bold opacity-30" id="slide-count">01 / 07</span>
                </div>
            </div>
        </div>

        <main id="main-content" class="flex-grow"></main>

        <footer class="py-6 text-center opacity-20 text-[8px] font-black tracking-[0.5em] uppercase">
            The Power Soul of Shalawat â€” Out of The Box Inside
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module">
        const SUPABASE_URL = 'https://rqpodzjexghrvcpyacyo.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_U9MbSdPJOMSmaw3BsHJcVQ_PDiOy-UM';
        window.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        let currentIdx = 0;

        // --- 7 SMART SLIDES CONTENT --- [cite: 2026-01-11]
        async function getDynamicSlides() {
            const { count: b } = await window.supabase.from('bookings').select('*', { count: 'exact', head: true }).eq('status', 'pending');
            const { count: k } = await window.supabase.from('k3_reports').select('*', { count: 'exact', head: true }).eq('status', 'pending');
            const isJumat = new Date().getDay() === 5; // [cite: 2026-01-18]

            return [
                { h: "Ø£ÙÙ‡Ù’Ù„Ù‹Ø§ ÙˆÙØ³ÙÙ‡Ù’Ù„Ù‹Ø§", p: "Command Center SIF Al-Fikri", t: "ISO 27001 ACTIVE", ar: true },
                { h: "ğŸ“… BOOKING", p: `Ada ${b || 0} Jadwal Menunggu Approval Hanung S.E`, t: "REALTIME SYNC" },
                { h: "âš ï¸ LAPORAN K3", p: `Terdeteksi ${k || 0} Masalah Teknis Di Lapangan`, t: "MAINTENANCE" },
                { h: "ğŸ›¡ï¸ SAFE CORE", p: "Radius 5KM Depok & Redmi Note 9 Pro Terproteksi", t: "GEOFENCE ACTIVE" },
                { h: isJumat ? "ğŸ•Œ JUMAT BERKAH" : "ğŸš€ DREAM TEAM", p: isJumat ? "Perbanyak Shalawat & Sedekah" : "Out of The Box Inside Mode Active", t: "SPIRITUAL SYNC" },
                { h: "ğŸŒ¤ï¸ AREA STATUS", p: "Kondisi Sekitar Al-Fikri: Cerah & Kondusif", t: "STABLE SYSTEM" },
                { h: "ğŸ“¢ DATA ISO", p: "Seluruh Aset & Inventaris Terenkripsi Sempurna", t: "ENCRYPTED" }
            ];
        }

        async function startSlideshow() {
            const display = document.getElementById('smart-content');
            const tag = document.getElementById('status-tag');
            const num = document.getElementById('slide-count');
            const data = await getDynamicSlides();

            setInterval(() => {
                display.style.opacity = '0';
                display.style.transform = 'translateY(10px)';
                setTimeout(() => {
                    const s = data[currentIdx];
                    display.innerHTML = `
                        <h2 class="${s.ar ? 'text-3xl arabic' : 'text-xl font-black text-yellow-500'} mb-1 uppercase">${s.h}</h2>
                        <p class="text-[11px] font-semibold opacity-70 leading-relaxed">${s.p}</p>
                    `;
                    tag.textContent = s.t;
                    num.textContent = `0${currentIdx + 1} / 07`;
                    display.style.opacity = '1';
                    display.style.transform = 'translateY(0)';
                    currentIdx = (currentIdx + 1) % data.length;
                }, 600);
            }, 7000); // 7 Detik Roleplay [cite: 2026-01-11]
        }

        async function router() {
            const content = document.getElementById('main-content');
            const panel = document.getElementById('logged-in-area');
            const allowed = sessionStorage.getItem('allowed_modules');

            if (!allowed) {
                panel.style.display = 'none';
                renderLogin();
                return;
            }

            panel.style.display = 'block';
            if(!window.init) { startSlideshow(); window.init = true; }

            const folder = (window.location.hash || '#home').slice(1);
            try {
                const res = await fetch(`./modules/${folder}/index.html`);
                content.innerHTML = await res.text();
                // Inject JS module...
            } catch { window.location.hash = '#home'; }
        }

        function renderLogin() {
            document.getElementById('main-content').innerHTML = `
                <div class="glass-card pillar-gold text-center mt-4">
                    <input type="password" id="mk" placeholder="MASTER KEY" class="w-full p-5 rounded-2xl bg-slate-900 border-none text-center font-black mb-6 ring-1 ring-white/10 focus:ring-yellow-500 text-white tracking-[0.3em]">
                    <button id="go" class="w-full bg-yellow-500 p-5 rounded-2xl font-black text-slate-900 uppercase tracking-widest shadow-xl active:scale-95">Enter System</button>
                </div>
            `;
            document.getElementById('go').onclick = async () => {
                const { data } = await window.supabase.from('access_codes').select('*').eq('code', document.getElementById('mk').value).maybeSingle();
                if (data) {
                    sessionStorage.setItem('allowed_modules', JSON.stringify(data.allowed_modules));
                    window.location.hash = '#home';
                    router();
                }
            };
        }

        window.addEventListener('hashchange', router);
        window.addEventListener('load', router);
    </script>
</body>
</html>

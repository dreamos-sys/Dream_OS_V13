<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#00f3ff">
    <title>DREAM OS v13.4</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Inter',sans-serif;min-height:100vh;background:linear-gradient(135deg,#0a0e27,#1a1f3a);color:#e2e8f0;overflow-x:hidden;padding-bottom:80px}
        .arabic{font-family:'Amiri',serif}
        .glass{background:rgba(255,255,255,0.05);border:1px solid rgba(0,243,255,0.2);border-radius:24px;backdrop-filter:blur(12px)}
        .neon-text{text-shadow:0 0 10px rgba(0,243,255,0.5)}
        .spinner{width:40px;height:40px;border:3px solid rgba(0,243,255,0.2);border-top-color:#00f3ff;border-radius:50%;animation:spin 1s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        .menu-card{transition:all 0.3s;cursor:pointer}
        .menu-card:hover{transform:translateY(-4px);box-shadow:0 8px 24px rgba(0,243,255,0.2)}
        .slide{display:none;min-width:100%;padding:1.5rem;flex-direction:column;align-items:center;justify-content:center;text-align:center;animation:fadeIn 0.5s}
        .slide.active{display:flex}
        .slider-dot{transition:all 0.3s}
        .slider-dot.active{width:20px;background:#06b6d4;border-radius:10px}
        .loading-screen{position:fixed;inset:0;background:linear-gradient(135deg,#0a0e27,#1a1f3a);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;transition:opacity 0.5s}
        .loading-screen.hidden{opacity:0;pointer-events:none}
        .fas,.far,.fab,.fa{font-family:'Font Awesome 6 Free'!important}
        .fas{font-weight:900}
    </style>
</head>
<body>

    <!-- LOADING SCREEN -->
    <div id="loading" class="loading-screen">
        <div class="spinner" style="width:60px;height:60px;border-width:4px;margin-bottom:1.5rem"></div>
        <h1 class="text-2xl font-bold neon-text mb-2">DREAM OS</h1>
        <p class="text-sm text-slate-400">v13.4 - Enterprise Edition</p>
        <p class="text-xs text-slate-500 mt-6">ğŸ¤– AI Powered â€¢ ğŸ”’ Secure</p>
    </div>

    <!-- MAIN APP -->
    <div id="app" class="max-w-3xl mx-auto p-4 md:p-6 space-y-6">        
        <!-- HEADER -->
        <header class="text-center py-4">
            <p class="text-2xl arabic neon-text mb-2" style="color:#fbbf24">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ€Ù°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</p>
            <p class="text-xs arabic opacity-70 mb-3">Ø§ÙÙ„Ù„Ù‡Ù… ØµÙÙ„ÙÙ‘ Ø¹ÙÙ„ÙÙ‰ Ø³ÙÙŠÙÙ‘Ø¯ÙÙ†ÙØ§ Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù</p>
            <h1 class="text-3xl font-black">DREAM <span style="color:#f59e0b">OS</span> <span class="text-sm font-mono" style="color:#f59e0b">v13.4</span></h1>
        </header>

        <!-- ===== 7 SLIDES (7 DETIK EACH) ===== -->
        <div class="glass relative overflow-hidden" style="min-height:200px">
            <div id="slider" class="flex transition-transform duration-700 ease-in-out">
                
                <!-- SLIDE 1: WELCOME -->
                <div class="slide active">
                    <p class="text-2xl font-black mb-2" style="color:#fbbf24">âœ¨ Selamat Datang</p>
                    <p class="text-sm text-slate-400 mb-3">Keluarga Besar SIF Al-Fikri</p>
                    <div class="flex gap-2 flex-wrap justify-center">
                        <span class="bg-emerald-600/80 text-white text-[10px] font-bold px-3 py-1 rounded-full">ISO 27001</span>
                        <span class="bg-cyan-600/80 text-white text-[10px] font-bold px-3 py-1 rounded-full">Active</span>
                        <span class="bg-blue-600/80 text-white text-[10px] font-bold px-3 py-1 rounded-full">v13.4</span>
                    </div>
                </div>

                <!-- SLIDE 2: BOOKING STATS -->
                <div class="slide">
                    <p class="text-xl font-bold mb-2" style="color:#3b82f6">ğŸ“… Booking</p>
                    <p class="text-4xl font-black" id="slide-booking">0</p>
                    <p class="text-xs text-slate-400 mt-1">Pending Approval</p>
                </div>

                <!-- SLIDE 3: K3 STATS -->
                <div class="slide">
                    <p class="text-xl font-bold mb-2" style="color:#f97316">âš ï¸ K3</p>
                    <p class="text-4xl font-black" id="slide-k3">0</p>
                    <p class="text-xs text-slate-400 mt-1">Laporan Menunggu</p>
                </div>

                <!-- SLIDE 4: WEATHER -->
                <div class="slide">
                    <p class="text-xl font-bold mb-2" style="color:#06b6d4">ğŸŒ¤ï¸ Cuaca</p>
                    <p class="text-2xl font-bold" id="slide-weather">Cerah, 26Â°C</p>
                    <p class="text-xs text-slate-400 mt-1">Depok Area</p>
                </div>

                <!-- SLIDE 5: ADMIN INFO -->
                <div class="slide">
                    <p class="text-xl font-bold mb-2" style="color:#a855f7">ğŸ“¢ Info Admin</p>
                    <p class="text-sm" id="slide-admin">Selamat datang di Dream OS! Silakan booking fasilitas.</p>
                </div>
                <!-- SLIDE 6: AI SUGGESTION -->
                <div class="slide">
                    <p class="text-xl font-bold mb-2" style="color:#ec4899">ğŸ’¡ Saran AI</p>
                    <p class="text-sm" id="slide-ai">Sistem berjalan normal</p>
                </div>

                <!-- SLIDE 7: PRAYER TIME -->
                <div class="slide" style="background:rgba(245,158,11,0.1)">
                    <p class="text-xl font-bold mb-2" style="color:#f59e0b">ğŸ•Œ Waktu Shalat</p>
                    <p class="text-sm" id="slide-prayer">Mari istirahat sejenak</p>
                    <p class="text-xs opacity-70 mt-1" id="slide-prayer-time">-</p>
                </div>

            </div>
            
            <!-- 7 SLIDE DOTS -->
            <div class="absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-1.5">
                <div class="w-1.5 h-1.5 rounded-full bg-cyan-500 slider-dot active"></div>
                <div class="w-1.5 h-1.5 rounded-full bg-slate-600 slider-dot"></div>
                <div class="w-1.5 h-1.5 rounded-full bg-slate-600 slider-dot"></div>
                <div class="w-1.5 h-1.5 rounded-full bg-slate-600 slider-dot"></div>
                <div class="w-1.5 h-1.5 rounded-full bg-slate-600 slider-dot"></div>
                <div class="w-1.5 h-1.5 rounded-full bg-slate-600 slider-dot"></div>
                <div class="w-1.5 h-1.5 rounded-full bg-slate-600 slider-dot"></div>
            </div>
        </div>

        <!-- ===== 9 ICONS DASHBOARD ===== -->
        <div class="text-center">
            <h2 class="text-lg font-bold mb-4" style="color:#f59e0b">Dashboard</h2>
            <div id="menu-grid" class="grid grid-cols-3 gap-3">
                <!-- 9 ICONS - GENERATED BY JS -->
            </div>
        </div>

        <!-- LOGOUT BUTTON -->
        <button onclick="logout()" class="w-full bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white p-4 rounded-2xl font-black shadow-lg transition-all">
            LOGOUT
        </button>

        <!-- MAIN CONTENT (Router for modules) -->
        <main id="main-content" class="space-y-6"></main>
    </div>

    <!-- SUPABASE -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- APP SCRIPT -->
    <script>
        // ===== CONFIG =====        const CONFIG={
            supabase:{url:'https://rqpodzjexghrvcpyacyo.supabase.co',key:'sb_publishable_U9MbSdPJOMSmaw3BsHJcVQ_PDiOy-UM'},
            slides:{interval:7000,total:7},
            prayer:{lat:-6.4,lon:106.8}
        };
        window.supabase=supabase.createClient(CONFIG.supabase.url,CONFIG.supabase.key);

        // ===== HIDE LOADING =====
        setTimeout(()=>{document.getElementById('loading').classList.add('hidden')},1500);

        // ===== 7 SLIDES - 7 DETIK EACH =====
        let currentSlide=0;
        const totalSlides=7;
        const slideInterval=7000; // 7 DETIK!

        function showSlide(index){
            const slider=document.getElementById('slider');
            const dots=document.querySelectorAll('.slider-dot');
            
            slider.style.transform=`translateX(-${index*100}%)`;
            
            dots.forEach((dot,i)=>{
                dot.classList.toggle('active',i===index);
                dot.classList.toggle('bg-cyan-500',i===index);
                dot.classList.toggle('bg-slate-600',i!==index);
            });
            
            currentSlide=index;
        }

        // Auto-slide setiap 7 detik
        setInterval(()=>{
            currentSlide=(currentSlide+1)%totalSlides;
            showSlide(currentSlide);
        },slideInterval);

        // ===== UPDATE SLIDE STATS =====
        async function updateSlideStats(){
            try{
                // Slide 2: Booking
                const{count:b}=await supabase.from('bookings').select('*',{count:'exact',head:true}).eq('status','pending');
                document.getElementById('slide-booking').textContent=b||0;

                // Slide 3: K3
                const{count:k}=await supabase.from('k3_reports').select('*',{count:'exact',head:true}).eq('status','pending');
                document.getElementById('slide-k3').textContent=k||0;

                // Slide 4: Weather
                const res=await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=-6.4&lon=106.8&appid=f7890d7569950ffa34a5827880e8442f&units=metric`);
                const data=await res.json();                document.getElementById('slide-weather').textContent=`${data.weather[0].description}, ${Math.round(data.main.temp)}Â°C`;

                // Slide 5: Admin Info
                const{data:admin}=await supabase.from('admin_info').select('content').eq('slide_number',5).order('created_at',{ascending:false}).limit(1);
                if(admin?.length)document.getElementById('slide-admin').textContent=admin[0].content;

                // Slide 6: AI Suggestion
                const hour=new Date().getHours();
                const day=new Date().getDay();
                let ai='Sistem berjalan normal';
                if(day===5&&hour>=10&&hour<=12)ai='ğŸ•Œ Jumat berkah! Persiapan shalat Jumat';
                else if(hour>=15&&hour<16)ai='ğŸ“‹ Saatnya laporan K3 sebelum pulang';
                else if(hour>=7&&hour<8)ai='â˜€ï¸ Selamat pagi! Cek jadwal booking';
                else if(hour>=12&&hour<13)ai='ğŸ½ï¸ Waktu istirahat, jangan lupa makan!';
                document.getElementById('slide-ai').textContent=ai;

                // Slide 7: Prayer Time
                const prayerRes=await fetch(`https://api.aladhan.com/v1/timingsByCoordinates?latitude=${CONFIG.prayer.lat}&longitude=${CONFIG.prayer.lon}&method=20`);
                const prayerData=await prayerRes.json();
                const prayers=['Fajr','Dhuhr','Asr','Maghrib','Isha'];
                const now=new Date();
                const current=now.getHours()*60+now.getMinutes();
                let nextPrayer={name:'Fajr',time:prayerData.data.timings.Fajr};
                for(let p of prayers){
                    const[h,m]=prayerData.data.timings[p].split(':').map(Number);
                    if((h*60+m)>current){nextPrayer={name:p,time:prayerData.data.timings[p]};break}
                }
                document.getElementById('slide-prayer').innerHTML=`â° Berikutnya: ${nextPrayer.name}`;
                document.getElementById('slide-prayer-time').textContent=nextPrayer.time;

            }catch(e){console.warn('âš ï¸ Slide update failed:',e)}
        }
        updateSlideStats();
        setInterval(updateSlideStats,30000);

        // ===== 9 ICONS DASHBOARD =====
        const menuMap={
            'booking':{name:'Booking',sub:'Sarana',icon:'fa-calendar-check',color:'bg-gradient-to-br from-blue-500 to-blue-700'},
            'k3':{name:'K3',sub:'Laporan',icon:'fa-triangle-exclamation',color:'bg-gradient-to-br from-orange-500 to-orange-700'},
            'sekuriti':{name:'Sekuriti',sub:'Laporan',icon:'fa-shield-halved',color:'bg-gradient-to-br from-green-600 to-green-800'},
            'janitor-indoor':{name:'Janitor',sub:'Indoor',icon:'fa-broom',color:'bg-gradient-to-br from-teal-500 to-teal-700'},
            'janitor-outdoor':{name:'Janitor',sub:'Outdoor',icon:'fa-leaf',color:'bg-gradient-to-br from-cyan-500 to-cyan-700'},
            'maintenance':{name:'Maintenance',sub:'Perbaikan',icon:'fa-screwdriver-wrench',color:'bg-gradient-to-br from-yellow-600 to-yellow-800'},
            'stok':{name:'Stok',sub:'Alat &',icon:'fa-box-archive',color:'bg-gradient-to-br from-purple-600 to-purple-800'},
            'asset':{name:'Asset',sub:'Inventaris',icon:'fa-building-shield',color:'bg-gradient-to-br from-indigo-600 to-indigo-800'},
            'commandcenter':{name:'Command',sub:'Center',icon:'fa-file-signature',color:'bg-gradient-to-br from-pink-600 to-pink-800',admin:true}
        };

        function renderMenu(){
            const allowed=JSON.parse(sessionStorage.getItem('allowed_modules')||'[]');            const visible=allowed.filter(id=>menuMap[id]);
            const grid=document.getElementById('menu-grid');
            
            if(!grid)return;
            
            if(visible.length===0){
                grid.innerHTML='<div class="col-span-full text-center py-8 opacity-60"><i class="fas fa-inbox text-4xl mb-3"></i><p>Tidak ada modul.</p></div>';
            }else{
                // Show max 9 icons (like screenshot)
                grid.innerHTML=visible.slice(0,9).map((id,i)=>{
                    const m=menuMap[id];
                    return `<a href="#${id}" class="menu-card ${m.color} text-white p-4 rounded-2xl text-center flex flex-col items-center justify-center" style="animation:fadeIn 0.3s ease ${i*0.05}s backwards">
                        <i class="fas ${m.icon} text-3xl mb-2"></i>
                        <span class="text-sm font-bold">${m.name}</span>
                        <span class="text-[8px] uppercase opacity-80">${m.sub}</span>
                    </a>`;
                }).join('');
            }
        }

        // ===== ROUTER =====
        async function router(){
            const main=document.getElementById('main-content');
            const allowed=sessionStorage.getItem('allowed_modules');
            
            if(!allowed){
                renderLogin();
                return;
            }
            
            renderMenu();
            
            const hash=window.location.hash||'#home';
            if(hash==='#home')return; // Home is default, no module load
            
            const path=`./modules/${hash.slice(1)}/index.html`;
            
            try{
                main.innerHTML='<div class="text-center py-8"><div class="spinner" style="margin:0 auto 1rem"></div><p class="text-sm text-slate-400">Loading...</p></div>';
                const r=await fetch(path);
                if(!r.ok)throw new Error(`HTTP ${r.status}`);
                main.innerHTML=await r.text();
                
                const script=document.createElement('script');
                script.src=`./modules/${hash.slice(1)}/${hash.slice(1)}.js?t=${Date.now()}`;
                document.body.appendChild(script);
                
            }catch(e){
                main.innerHTML='<p class="text-center text-red-400"><i class="fas fa-triangle-exclamation text-2xl mb-2"></i><br>Error: '+e.message+'</p>'
            }        }

        // ===== LOGIN =====
        function renderLogin(){
            document.getElementById('main-content').innerHTML=`
                <div class="glass p-6 rounded-2xl max-w-md mx-auto">
                    <div class="text-center mb-4">
                        <i class="fas fa-lock text-5xl mb-3" style="color:#00f3ff"></i>
                        <h2 class="text-xl font-bold">Dream OS</h2>
                        <p class="text-xs text-slate-400">Access Control</p>
                    </div>
                    <input type="password" id="pass" placeholder="Access Code" class="w-full p-3 rounded-xl bg-slate-800 border border-slate-700 text-white text-center mb-3">
                    <button onclick="login()" class="w-full bg-cyan-600 hover:bg-cyan-500 text-white p-3 rounded-xl font-bold">LOGIN</button>
                    <p id="msg" class="text-center text-sm mt-3"></p>
                </div>
            `;
        }

        async function login(){
            const code=document.getElementById('pass').value.trim();
            const msg=document.getElementById('msg');
            
            if(!code){msg.innerHTML='<span class="text-red-400">âš ï¸ Masukkan code!</span>';return;}
            
            msg.innerHTML='<span class="text-yellow-400">â³...</span>';
            const{data,error}=await supabase.from('access_codes').select('allowed_modules').eq('code',code).maybeSingle();
            
            if(error){msg.innerHTML='<span class="text-red-400">âŒ '+error.message+'</span>';return;}
            
            if(data){
                sessionStorage.setItem('allowed_modules',JSON.stringify(data.allowed_modules));
                msg.innerHTML='<span class="text-green-400">âœ… Success!</span>';
                setTimeout(()=>{window.location.hash='#home';router()},1000);
            }else{
                msg.innerHTML='<span class="text-red-400">âŒ Wrong!</span>';
                document.getElementById('pass').value='';
            }
        }

        // ===== LOGOUT =====
        window.logout=()=>{
            if(confirm('âš ï¸ Yakin ingin logout?')){
                sessionStorage.removeItem('allowed_modules');
                window.location.href='/';
            }
        };

        // ===== INIT =====
        window.addEventListener('hashchange',router);
        window.addEventListener('load',()=>{            console.log('ğŸš€ Dream OS v13.4 Loaded');
            console.log('ğŸ“Š Slides: 7 (7 detik each)');
            console.log('ğŸ¯ Icons: 9 max');
            console.log('ğŸ”’ Security: Ready');
            router()
        });
    </script>
</body>
</html>
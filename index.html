<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Dream OS v13.3 - AI Master Ultimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; overscroll-behavior: none; transition: background 0.5s ease; }
        .arabic { font-family: 'Amiri', serif; }
        .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .dark .glass { background: rgba(18, 18, 18, 0.8); }
        
        #slideshow-container { display: none; position: relative; height: 6.5rem; overflow: hidden; border-radius: 1.5rem; }
        .slide { 
            transition: opacity 1s ease-in-out; 
            position: absolute; inset: 0; 
            display: flex; align-items: center; justify-content: center; 
            text-align: center; font-weight: 800; font-size: 0.8rem; padding: 1rem;
            line-height: 1.4;
        }

        @keyframes pulse-gold { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .spiritual-text { animation: pulse-gold 3s infinite; }
        
        /* Automation Mode: Jumat Berkah */
        body.jumat-mode { background: radial-gradient(circle at top, #1e293b, #0f172a); }
        body.jumat-mode .spiritual-text { color: #fbbf24; text-shadow: 0 0 10px rgba(251, 191, 36, 0.5); }
    </style>
</head>
<body class="bg-slate-50 dark:bg-[#0f172a] min-h-screen text-slate-900 dark:text-slate-100">
    <div id="app" class="max-w-md mx-auto min-h-screen flex flex-col p-4">
        
        <header class="text-center py-6">
            <p class="text-2xl arabic spiritual-text text-yellow-600 dark:text-yellow-500">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ€Ù°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</p>
            <p class="text-[10px] arabic opacity-70">Ø§ÙÙ„Ù„Ù‡Ù… ØµÙÙ„Ù‘Ù Ø¹ÙÙ„ÙÙ‰ Ø³ÙÙŠÙ‘ÙØ¯ÙÙ†ÙØ§ Ù…ÙØ­ÙÙ…Ù‘ÙØ¯Ù ÙˆÙØ¹ÙÙ„ÙÙ‰ Ø¢Ù„Ù Ø³ÙÙŠÙ‘ÙØ¯ÙÙ†ÙØ§ Ù…ÙØ­ÙÙ…Ù‘ÙØ¯Ù</p>
            <h1 class="text-xl font-extrabold tracking-tighter mt-2 uppercase italic">DREAM OS <span class="text-yellow-500">v13.3</span></h1>
        </header>

        <div id="slideshow-container" class="glass mb-6 border-yellow-500/30 shadow-xl overflow-hidden">
            <div id="dynamic-slides">
                </div>
        </div>

        <main id="main-content" class="flex-grow"></main>

        <footer class="py-4 text-center opacity-40 text-[10px] font-bold tracking-widest uppercase">
            The Power Soul of Shalawat â€” ISO 27001 Certified
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module">
        const SUPABASE_URL = 'https://rqpodzjexghrvcpyacyo.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_U9MbSdPJOMSmaw3BsHJcVQ_PDiOy-UM';
        window.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // --- AI & AUTOMATION LOGIC --- [cite: 2026-01-18]
        const AI_CONFIG = {
            key: "Nvapi-Q0yxmHn2XI4SeBvvXiLNiie1VfJ0f6rDmQbIdEOz8j4hiZ93GoP4EQdGq_OLyosK",
            mode: "Automation Active"
        };

        const getSmartContent = () => {
            const today = new Date().getDay(); // 5 = Jumat
            const hour = new Date().getHours();
            
            let contextSlides = [
                { text: "âœ¨ DREAM OS AI: SYSTEM STABLE âœ¨", color: "text-yellow-500" },
                { text: "ğŸ“… BOOKING PENDING: <span id='s-b'>0</span>", color: "text-blue-500" },
                { text: "âš ï¸ K3 REPORT: <span id='s-k'>0</span>", color: "text-orange-500" },
                { text: "ğŸ›¡ï¸ SAFE CORE: <span id='s-z'>SCANNING...</span>", color: "text-emerald-500" }
            ];

            if (today === 5) { // FRIDAY AUTOMATION
                document.body.classList.add('jumat-mode');
                contextSlides.unshift({ text: "ğŸ•Œ JUMAT BERKAH: PERBANYAK SHALAWAT", color: "text-yellow-400 spiritual-text" });
                contextSlides.push({ text: "ğŸŒ™ JUMAT MODE: NOTIFIKASI DISARING", color: "text-pink-400" });
            } else {
                contextSlides.unshift({ text: "ğŸš€ SEMANGAT KERJA: DREAM TEAM ACTIVE", color: "text-cyan-400" });
            }

            return contextSlides;
        };

        // --- ROUTER ENGINE ---
        async function router() {
            const content = document.getElementById('main-content');
            const slider = document.getElementById('slideshow-container');
            const allowed = sessionStorage.getItem('allowed_modules');

            if (!allowed) {
                slider.style.display = 'none';
                renderLogin();
                return;
            }

            slider.style.display = 'block';
            initSmartSlideshow();
            checkZeroPoint();

            const hash = window.location.hash || '#home';
            const folder = hash.slice(1) || 'home';

            try {
                const response = await fetch(`./modules/${folder}/index.html`);
                content.innerHTML = await response.text();

                const oldScript = document.getElementById('module-script');
                if (oldScript) oldScript.remove();

                const script = document.createElement('script');
                script.id = 'module-script';
                script.type = 'module';
                script.src = `./modules/${folder}/${folder}.js?v=${Date.now()}`;
                document.body.appendChild(script);
                
                updateData();
            } catch (err) {
                window.location.hash = '#home';
            }
        }

        // --- LOGIN & SECURE ACCESS ---
        function renderLogin() {
            const content = document.getElementById('main-content');
            content.innerHTML = `
                <div class="glass p-8 rounded-[2.5rem] shadow-2xl mt-4 border-white/20">
                    <div class="relative mb-4">
                        <input type="password" id="pass" placeholder="MASTER KEY" class="w-full p-4 rounded-2xl border-none ring-2 ring-yellow-500/20 focus:ring-yellow-500 bg-white dark:bg-slate-800 text-center text-xl font-bold">
                        <button id="eye" class="absolute right-4 top-4 opacity-50">ğŸ‘ï¸</button>
                    </div>
                    <button id="go" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-black p-4 rounded-2xl shadow-lg transition-all active:scale-95">ACCESS SYSTEM</button>
                </div>
            `;
            const p = document.getElementById('pass');
            document.getElementById('eye').onclick = () => {
                p.type = p.type === 'password' ? 'text' : 'password';
            };
            document.getElementById('go').onclick = async () => {
                const { data } = await window.supabase.from('access_codes').select('*').eq('code', p.value).maybeSingle();
                if (data) {
                    sessionStorage.setItem('allowed_modules', JSON.stringify(data.allowed_modules));
                    window.location.hash = '#home';
                    router();
                }
            };
        }

        // --- TITIK ZERO LOGIC (5 KM) --- [cite: 2026-01-14]
        function checkZeroPoint() {
            navigator.geolocation.getCurrentPosition((pos) => {
                const R = 6371;
                const dLat = (pos.coords.latitude - (-6.4025)) * Math.PI / 180;
                const dLon = (pos.coords.longitude - (106.7942)) * Math.PI / 180;
                const a = Math.sin(dLat/2)**2 + Math.cos(-6.4025 * Math.PI / 180) * Math.cos(pos.coords.latitude * Math.PI / 180) * Math.sin(dLon/2)**2;
                const dist = R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                const el = document.getElementById('s-z');
                if(el) el.innerHTML = dist > 5 ? "ğŸ”´ OUTSIDE" : "ğŸ›¡ï¸ SECURE";
            });
        }

        // --- SMART SLIDESHOW ENGINE (7 SEC) --- [cite: 2026-01-11]
        let cur = 0;
        function initSmartSlideshow() {
            const container = document.getElementById('dynamic-slides');
            const contents = getSmartContent();
            container.innerHTML = contents.map((c, i) => `
                <div class="slide ${i === 0 ? 'opacity-100' : 'opacity-0'} ${c.color}">${c.text}</div>
            `).join('');

            if (!window.aiLoop) {
                setInterval(() => {
                    const slides = document.querySelectorAll('.slide');
                    slides.forEach((s, i) => s.style.opacity = i === cur ? '1' : '0');
                    cur = (cur + 1) % slides.length;
                }, 7000);
                window.aiLoop = true;
            }
        }

        async function updateData() {
            const { count: b } = await window.supabase.from('bookings').select('*', { count: 'exact', head: true }).eq('status', 'pending');
            const { count: k } = await window.supabase.from('k3_reports').select('*', { count: 'exact', head: true }).eq('status', 'pending');
            if(document.getElementById('s-b')) document.getElementById('s-b').textContent = b || 0;
            if(document.getElementById('s-k')) document.getElementById('s-k').textContent = k || 0;
        }

        window.addEventListener('hashchange', router);
        window.addEventListener('load', router);
    </script>
</body>
</html>

<div class="max-w-2xl mx-auto p-4">
    <div class="text-center mb-6">
        <h2 class="text-xl font-semibold text-yellow-600">Dashboard</h2>
    </div>

    <!-- Debug box besar -->
    <div id="debug-info" class="text-xs text-left mb-2 p-2 bg-gray-800 text-green-400 rounded overflow-auto max-h-32" style="font-family: monospace;">
        Memuat debug...
    </div>

    <!-- Grid 9 IKON -->
    <div id="menu-grid" class="grid grid-cols-3 gap-3">
        <!-- Akan diisi oleh JavaScript -->
    </div>

    <button id="logout" class="mt-6 w-full bg-red-500 hover:bg-red-600 text-white p-3 rounded-xl">Logout</button>
</div>

<script type="module">
    import { supabase } from '../../lib/supabaseClient.js';

    // ========== AMBIL ALLOWED MODULES ==========
    const allowed = JSON.parse(sessionStorage.getItem('allowed_modules') || '[]');
    const debugDiv = document.getElementById('debug-info');
    debugDiv.innerHTML = `ğŸ“¦ Raw allowed: ${allowed.join(', ') || 'kosong'}<br>`;

    // ========== DEFINISI SEMUA IKON (9 MODUL) ==========
    const menuMap = {
        'booking': { name: 'Booking Sarana', icon: 'ğŸ“…', color: 'bg-blue-500' },
        'k3': { name: 'Laporan K3', icon: 'âš ï¸', color: 'bg-orange-500' },
        'sekuriti': { name: 'Laporan Sekuriti', icon: 'ğŸ›¡ï¸', color: 'bg-green-600' },
        'janitor-indoor': { name: 'Janitor Indoor', icon: 'ğŸ§¹', color: 'bg-teal-600' },
        'janitor-outdoor': { name: 'Janitor Outdoor', icon: 'ğŸŒ¿', color: 'bg-cyan-600' },
        'stok': { name: 'Alat & Stok', icon: 'ğŸ“¦', color: 'bg-purple-600' },
        'maintenance': { name: 'Maintenance', icon: 'ğŸ”§', color: 'bg-yellow-600' },
        'asset': { name: 'Asset', icon: 'ğŸ¢', color: 'bg-indigo-600' },
        'commandcenter': { name: 'Command Center', icon: 'ğŸ“Š', color: 'bg-pink-600' }
    };

    debugDiv.innerHTML += `ğŸ“‹ MenuMap keys: ${Object.keys(menuMap).join(', ')}<br>`;

    // ========== FILTER MODUL YANG DIIZINKAN ==========
    const visible = allowed.filter(id => menuMap[id]);
    debugDiv.innerHTML += `âœ… Visible modules: ${visible.join(', ') || 'tidak ada'}<br>`;

    // ========== RENDER MENU ==========
    const grid = document.getElementById('menu-grid');
    if (visible.length === 0) {
        grid.innerHTML = '<p class="col-span-3 text-center">Tidak ada modul tersedia.</p>';
    } else {
        grid.innerHTML = visible.map(id => `
            <a href="#${id}" class="${menuMap[id].color} text-white p-3 rounded-xl text-center font-semibold shadow hover:opacity-90 transition flex flex-col items-center justify-center">
                <span class="text-3xl mb-1">${menuMap[id].icon}</span>
                <span class="text-xs">${menuMap[id].name}</span>
            </a>
        `).join('');
    }

    debugDiv.innerHTML += `ğŸ¨ Jumlah ikon dirender: ${visible.length}<br>`;

    // ========== LOGOUT ==========
    document.getElementById('logout').addEventListener('click', (e) => {
        e.preventDefault();
        console.log('ğŸ”´ Logout diklik');
        sessionStorage.removeItem('allowed_modules');
        window.location.href = '/Dream_OS_V13/'; // sesuaikan jika perlu
    });
</script>
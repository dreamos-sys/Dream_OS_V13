<div class="max-w-2xl mx-auto p-4">
    <div class="text-center mb-6">
        <h2 class="text-xl font-semibold text-yellow-600">Dashboard</h2>
    </div>
    <div id="menu-grid" class="grid grid-cols-2 gap-3 md:grid-cols-3"></div>
    <button id="logout" class="mt-6 w-full bg-red-500 hover:bg-red-600 text-white p-3 rounded-xl">Logout</button>
</div>

<script type="module">
    // ========== RENDER MENU ==========
    function renderMenu() {
        const allowed = JSON.parse(sessionStorage.getItem('allowed_modules') || '[]');
        console.log('üìã Modul yang diizinkan:', allowed);

        const menuMap = {
            booking: { name: 'Booking Sarana', icon: 'üìÖ', color: 'bg-blue-500' },
            k3: { name: 'Laporan K3', icon: '‚ö†Ô∏è', color: 'bg-orange-500' },
            sekuriti: { name: 'Laporan Sekuriti', icon: 'üîí', color: 'bg-green-600' },
            janitor: { name: 'Ceklis Janitor', icon: 'üßπ', color: 'bg-teal-600' },
            stok: { name: 'Alat & Stok', icon: 'üì¶', color: 'bg-purple-600' },
            maintenance: { name: 'Maintenance', icon: 'üîß', color: 'bg-yellow-600' },
            asset: { name: 'Asset', icon: 'üè¢', color: 'bg-indigo-600' },
            commandcenter: { name: 'Command Center', icon: 'üìä', color: 'bg-pink-600' }
        };

        const grid = document.getElementById('menu-grid');
        const visible = allowed.filter(id => menuMap[id]);

        if (visible.length === 0) {
            grid.innerHTML = '<p class="col-span-full text-center">Tidak ada modul tersedia.</p>';
        } else {
            grid.innerHTML = visible.map(id => `
                <a href="#${id}" class="${menuMap[id].color} text-white p-4 rounded-xl text-center font-semibold shadow hover:opacity-90 transition">
                    <span class="block text-2xl mb-1">${menuMap[id].icon}</span>
                    ${menuMap[id].name}
                </a>
            `).join('');
        }
    }

    renderMenu();

    // ========== HANDLER LOGOUT (DUA JALUR) ==========
    function setupLogout() {
        const logoutBtn = document.getElementById('logout');
        if (logoutBtn) {
            // Hapus event listener lama (jika ada)
            logoutBtn.replaceWith(logoutBtn.cloneNode(true));
            const newLogoutBtn = document.getElementById('logout');
            
            newLogoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('üî¥ Tombol logout diklik');
                sessionStorage.removeItem('allowed_modules');
                console.log('‚úÖ Session dihapus, reload...');
                window.location.reload();
            });
            console.log('‚úÖ Event listener logout dipasang');
        } else {
            console.error('‚ùå Tombol logout tidak ditemukan!');
        }
    }

    // Coba dengan DOMContentLoaded
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupLogout);
    } else {
        setupLogout(); // DOM sudah siap
    }

    // Fallback: coba lagi setelah 1 detik (untuk jaga-jaga)
    setTimeout(setupLogout, 1000);
</script>

<div class="max-w-2xl mx-auto p-4">
    <div class="text-center mb-6">
        <h2 class="text-xl font-semibold text-yellow-600">Dashboard</h2>
    </div>

    <!-- Debug box (bisa dihapus nanti) -->
    <div id="debug-info" class="text-xs text-left mb-2 p-2 bg-gray-800 text-green-400 rounded overflow-auto max-h-32" style="font-family: monospace;">
        Memuat debug...
    </div>

    <!-- Grid 9 IKON dengan HOVER EFFECT -->
    <div id="menu-grid" class="grid grid-cols-3 gap-3">
        <!-- Akan diisi oleh JavaScript -->
    </div>

(function() {
    const form = document.getElementById('bookForm');
    if (!form) return;

    form.onsubmit = async (e) => {
        e.preventDefault();
        const feedback = document.getElementById('feedback');
        feedback.innerHTML = "ğŸŒ€ Processing...";

        const data = {
            nama: document.getElementById('nama').value,
            sarana: document.getElementById('sarana').value,
            tgl: new Date(document.getElementById('tgl').value),
            jamM: document.getElementById('jamM').value,
            jamS: document.getElementById('jamS').value
        };

        // ğŸ›¡ï¸ Logic Sakral
        const now = new Date();
        const diff = (data.tgl - now.setHours(0,0,0,0)) / (1000*60*60*24);
        const hari = data.tgl.getDay();

        // 1. Validasi H-1
        if (diff < 1) {
            feedback.innerHTML = "âŒ Error: Booking wajib H-1, Bro!";
            return;
        }

        // 2. Validasi Jam Kerja (07:30 - 16:00)
        if (data.jamM < "07:30" || data.jamS > "16:00") {
            feedback.innerHTML = "âŒ Jam kerja: 07:30 - 16:00 saja.";
            return;
        }

        // 3. Validasi Weekend (Sabtu=6, Minggu=0)
        if (hari === 0 || hari === 6) {
            feedback.innerHTML = "âš ï¸ Weekend? Hubungi Pak Hanung Budianto S.E / Erwinsyah.";
            return;
        }

        // Simpan ke Supabase
        const { error } = await window.supabase.from('bookings').insert([{
            nama: data.nama, sarana: data.sarana, tanggal_mulai: document.getElementById('tgl').value,
            jam_mulai: data.jamM, jam_selesai: data.jamS, status: 'pending'
        }]);

        if (!error) {
            feedback.innerHTML = "âœ… Berhasil! Menunggu Approval Pak Hanung.";
            form.reset();
        } else {
            feedback.innerHTML = "âŒ Gagal: " + error.message;
        }
    };
})();

    <button id="logout" class="mt-6 w-full bg-red-500 hover:bg-red-600 text-white p-3 rounded-xl hover-lift">Logout</button>
</div>

<script type="module">
    import { supabase } from '../../lib/supabaseClient.js';

    const allowed = JSON.parse(sessionStorage.getItem('allowed_modules') || '[]');
    const debugDiv = document.getElementById('debug-info');
    debugDiv.innerHTML = `ğŸ“¦ Raw allowed: ${allowed.join(', ') || 'kosong'}<br>`;

    const menuMap = {
        'booking': { name: 'Booking Sarana', icon: 'ğŸ“…', color: 'bg-blue-500' },
        'k3': { name: 'Laporan K3', icon: 'âš ï¸', color: 'bg-orange-500' },
        'sekuriti': { name: 'Laporan Sekuriti', icon: 'ğŸ›¡ï¸', color: 'bg-green-600' },
        'janitor-indoor': { name: 'Janitor Indoor', icon: 'ğŸ§¹', color: 'bg-teal-600' },
        'janitor-outdoor': { name: 'Janitor Outdoor', icon: 'ğŸŒ¿', color: 'bg-cyan-600' },
        'stok': { name: 'Alat & Stok', icon: 'ğŸ“¦', color: 'bg-purple-600' },
        'maintenance': { name: 'Maintenance', icon: 'ğŸ”§', color: 'bg-yellow-600' },
        'asset': { name: 'Asset', icon: 'ğŸ¢', color: 'bg-indigo-600' },
        'commandcenter': { name: 'Command Center', icon: 'ğŸ“Š', color: 'bg-pink-600' }
    };

    debugDiv.innerHTML += `ğŸ“‹ MenuMap keys: ${Object.keys(menuMap).join(', ')}<br>`;

    const visible = allowed.filter(id => menuMap[id]);
    debugDiv.innerHTML += `âœ… Visible modules: ${visible.join(', ') || 'tidak ada'}<br>`;

    const grid = document.getElementById('menu-grid');
    if (visible.length === 0) {
        grid.innerHTML = '<p class="col-span-3 text-center">Tidak ada modul tersedia.</p>';
    } else {
        grid.innerHTML = visible.map(id => `
            <a href="#${id}" class="${menuMap[id].color} text-white p-3 rounded-xl text-center font-semibold shadow transition-all duration-300 transform hover:scale-105 hover:shadow-xl flex flex-col items-center justify-center">
                <span class="text-3xl mb-1">${menuMap[id].icon}</span>
                <span class="text-xs">${menuMap[id].name}</span>
            </a>
        `).join('');
    }

    debugDiv.innerHTML += `ğŸ¨ Jumlah ikon dirender: ${visible.length}<br>`;

    document.getElementById('logout').addEventListener('click', (e) => {
        e.preventDefault();
        sessionStorage.removeItem('allowed_modules');
        window.location.href = '/Dream_OS_V13/';
    });
</script>